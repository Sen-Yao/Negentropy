
# 三、战斗概要

## 1. 回合顺序

进入战斗后，双方战斗实体根据各自的先攻值从高到低排序决定回合顺序。

例如红队角色A，B；蓝队角色C，D。他们的先攻值为 23, 32, 54, 10

则在此次战斗中，回合顺序将为

$$CBAD-CBAD-CBAD\cdots $$

## 2. 战斗选择

对于战斗实体而言，在本回合将会有如下战斗操作可供选择，除非特殊说明，每个回合只能执行一个战斗操作

- 普通攻击
- 技能
- 格挡
- 休息
- 使用道具
- 逃跑

### 2.1 普通攻击

普通攻击是一种最简朴的物理攻击。选定一个敌方实体即可进行普通攻击。普通攻击在正常情况下的基础伤害定义为「普通攻击基础伤害」

$$普通攻击基础伤害=武器面板伤害\times \ln[\frac{进攻方力量-防守方韧性}{50}+3]\times (1-e^{-\frac{防守方护甲值}{100}})\times 对应武器熟练度$$

### 2.2 技能

技能分为物理技能和法术技能两种，两种技能的伤害计算公式略有不同

$$物理技能基础伤害=技能面板伤害\times 基础倍数 $$

$$法术技能基础伤害=法术面板伤害\times \frac{智力值}{50}\times $$

### 2.3 格挡

参见格挡系统

### 2.4 休息

选择休息后，战斗实体在本回合无法进行任何其他活动，在下一回合开始前恢复当前已失去精力值的$40\%$

### 2.5 使用道具

玩家可以打开背包，使用某些允许在战斗中使用的道具

### 2.6 逃跑

当玩家距离最近的敌人三格以上时，可以选择「逃跑」。逃跑时需要保存场上所有实体的所有状态数据。

若此战斗为逃跑方发起的，则直接退出战斗。若此战斗为对方发起的，则逃跑后会进入一组选项，分别是

- 继续战斗！
- 以牺牲 X 名队友为代价仓皇逃离！（待定）
- 投降

其中，继续战斗将会恢复玩家上一次逃跑时保存双方的所有状态，按照新阵型重新投入战场

投降，对于大部分任务来说，直接读档，但以后这里可以做一些其他的剧情。

# 四、伤害计算

## 1. 基础伤害

任何攻击和技能均有一个基础伤害，取决于武器和技能本身，与攻防双方的属性无关

## 2. 基础倍数

考虑攻防双方的属性，定义基础倍数为

$$\ln[\frac{进攻方力量-防守方韧性}{50}+3]\times e^{-\frac{防守方护甲值}{1000}}\times \frac{熟练度+50}{100}$$

其中“熟练度”为进攻方对应技艺的熟练度

## 实际伤害

待更新

---

# 四、BUFF

BUFF 有「等级」和「持续时间」两个参数，其中「等级」决定了效果的强烈程度，而「持续时间」以回合计算。个别 BUFF 只有「持续时间」一个参数。

下面的文档只对等级对应的效果做了划分，具体的持续时间由技能等决定

## 1. 增益BUFF

### 生命恢复

实体将会缓慢的恢复生命值，持续一定时长

- 等级1: 每回合 5 点
- 等级2: 每回合 10 点
- 等级3: 每回合 20 点
- 等级4: 每回合 50 点
- 等级5: 每回合 100 点


### 法力恢复

实体将会缓慢的恢复法力值，持续一定时长

- 等级1: 每回合 5 点
- 等级2: 每回合 10 点
- 等级3: 每回合 20 点
- 等级4: 每回合 50 点
- 等级5: 每回合 100 点


### 精力恢复

实体将会缓慢的恢复精力值，持续一定时长，且在持续时间内，精力值消耗减少一定百分比

- 等级1: 每回合 5 点
- 等级2: 每回合 10 点
- 等级3: 每回合 20 点
- 等级4: 每回合 50 点
- 等级5: 每回合 100 点


$$精力消耗减少百分比=0.3\times (e^\frac{剩余持续时长}{总持续时长}-1)$$

### 迅捷

实体的「敏捷」得到暂时性的提高

- 等级1: 变为原来的 110%
- 等级2: 变为原来的 120%
- 等级3: 变为原来的 130%
- 等级4: 变为原来的 140%
- 等级5: 变为原来的 150%

## 2. 减益BUFF

### 中毒

实体中毒后将会持续受到伤害，并且会影响进攻时的命中率 // 可以理解为毒得头晕眼花（？

若中毒是由近战攻击带来，则在格挡成功时无法生效

- 等级1: 每回合 5 点，且命中率变为 90%
- 等级2: 每回合 10 点，且命中率变为 80%
- 等级3: 每回合 20 点，且命中率变为 60%
- 等级4: 每回合 50 点，且命中率变为 40%
- 等级5: 每回合 100 点，，且命中率变为 20%

### 流血

流血状态的实体会持续受到伤害，并且流血时进行任何移动和攻击都会使持续时间延长一回合 // 理解为伤口无法愈合

若流血是由近战攻击带来，则在格挡成功时无法生效。

- 等级1: 每回合 5 点
- 等级2: 每回合 10 点
- 等级3: 每回合 20 点
- 等级4: 每回合 50 点
- 等级5: 每回合 100 点

### 霜冻

霜冻的实体的敏捷将会下降，且耐力受到影响

- 等级1: 每回合 5 点耐力，敏捷变为原来的 90%
- 等级2: 每回合 10 点耐力，敏捷变为原来的 80%
- 等级3: 每回合 20 点耐力，敏捷变为原来的 60%
- 等级4: 每回合 50 点耐力，敏捷变为原来的 40%
- 等级5: 每回合 100 点耐力，敏捷变为原来的 20%

### 麻痹

无等级划分。进入麻痹状态的实体无法攻击，使用技能，防守，但可以使用道具。

### 昏迷

无等级划分。进入昏迷状态的实体无法进行任何操作，且无法恢复精力和法力

## 五、闪避系统

战斗中，进攻方的进攻没有命中的机制称为「闪避」。闪避是一个自动进行的机制，并不需要「刻意」去闪避，而是**在每一次进攻行为发起时计算是否命中**

在《负熵》中，大部分攻击在一定条件下是允许被闪避的。其中部分技能无法被闪避，即具有指向性，会在技能说明页面特别强调。

### 闪避计算

闪避几率受到以下数值影响

- 双方精力
- 双方敏捷
- 进攻方武器重量（物理攻击）或进攻方施法冷却时间（法术攻击）：重量级的武器和法术破绽更大，更难命中
- 防守方护甲重量：轻甲更加灵动，更容易提前躲开不必要受到的攻击。

闪避率由四个因数构成

$令x=进攻方精力值-防守方精力值$

$$精力因数=\frac{|x|}{2x}\cdot(1-e^{-|\frac{x}{30}|})+0.8$$

$令x=进攻方敏捷-防守方敏捷$

$$敏捷因数=\frac{|x|}{2x}\cdot(1-e^{-|\frac{x}{30}|})+0.8$$

$令x=进攻方武器重量或施法冷却时间$

$$进攻重量因数=\begin{cases}
\frac{200-x}{100}（物理攻击）\\
\frac{10-x}{5}（法术攻击）
\end{cases}$$

$令x=防守方护甲重量$

$$护甲重量因数=\frac{200-x}{100}$$

综合以上四个因数

$$闪避率=精力因数\times 敏捷因数\times 进攻重量因数\times 护甲重量因数$$

这样算出来的闪避率理应在$0\sim 100\%$之间，若超出上下限，应强制让其取 $0$ 或 $1$

## 六、格挡系统

在战斗中除了直接恢复精力，还有一种相对安全的选择——「格挡」

战斗实体在精力值较低时可以牺牲精力的恢复效果来换取更加安全的防御态势。相比于直接进行休息能恢复已失去精力值的$40\%$，格挡时只能恢复已失去精力值的$20\%$，但会进入「格挡状态」。期间受到的伤害都会进行格挡判定。

在《负熵》中，大部分攻击在一定条件下是可以被格挡的。其中部分技能无法被格挡，会在技能说明页面特别强调。

格挡成功时，会消耗格挡者一定的精力。

格挡可以减弱甚至免除某些攻击带来的DEBUFF，比如流血等

### 格挡质量

格挡成功时，防守方收到的伤害和 DEBUFF 均会减少。一次高质量的格挡能在最大程度减少伤害的同时，降低对格挡者的耐力影响。格挡的质量由「格挡质量」来衡量，其取值为（$0-100\%）$

#### 格挡质量的计算

格挡质量由格挡者的精力值、格挡技艺熟练和对方本次进攻消耗的精力值、格挡物属性确定

$$格挡质量=\frac{格挡者当前精力值}{100} \times (25+\frac{进攻方精力消耗}{20000})\times \ln(0.15+0.1\ln(\frac{格挡技艺熟练度+50}{150})$$

以上公式还在优化

格挡质量影响格挡方收到的伤害和 DEBUFF 效果

$$实际伤害（效果）=原伤害（效果）\times 格挡质量$$

### 破防

在某些势大力沉的攻击下，质量较低的格挡可能会直接破防，即格挡质量为0。格挡失败，受到正常应有的伤害，而且在重新架起格挡之前，都处于没有格挡的脆弱状态。111